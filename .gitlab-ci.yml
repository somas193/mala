default:
  image: registry.hzdr.de/multiscale-wdm/surrogate-models/fesl/fesl

stages:
  - build
  - test
  - deploy

.module_setup: &module_setup
    - cd ../
    - git clone https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.hzdr.de/multiscale-wdm/surrogate-models/fesl/data  fesl_data_repo
    - cd fesl_data_repo
    - git lfs install
    - bash ../fesl/install/data_repo_link/link_data_repo.sh `pwd`
    - cd ../
    - cd fesl
    - conda env create -f install/fesl_cpu_environment.yml
    - conda activate fesl-cpu
    - pip install -e .

setup-fesl:
  stage: build
  before_script:
    - *module_setup
  script:
    - python examples/ex00_verify_installation.py
#  after_script:
  only:
    - master
    - conda-CI
    - pipelinetest

